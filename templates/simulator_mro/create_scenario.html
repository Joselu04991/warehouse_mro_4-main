{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h3 class="mb-0"><i class="bi bi-plus-circle me-2"></i> Crear Nuevo Escenario MRO</h3>
                </div>
                <div class="card-body">
                    <form id="scenarioForm">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="scenarioName" class="form-label">Nombre del Escenario *</label>
                                    <input type="text" class="form-control" id="scenarioName" 
                                           placeholder="Ej: Gestión de Inventario Crítico durante Emergencia" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="scenarioCode" class="form-label">Código de Escenario</label>
                                    <input type="text" class="form-control" id="scenarioCode" 
                                           placeholder="MRO-SC-001" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="scenarioType" class="form-label">Tipo de Escenario *</label>
                                <select class="form-select" id="scenarioType" required>
                                    <option value="">Seleccionar tipo...</option>
                                    <option value="inventory">Gestión de Inventario</option>
                                    <option value="maintenance">Mantenimiento Preventivo</option>
                                    <option value="emergency">Emergencia de Equipos</option>
                                    <option value="logistics">Logística de Repuestos</option>
                                    <option value="quality">Control de Calidad</option>
                                    <option value="safety">Seguridad Industrial</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="department" class="form-label">Departamento Objetivo</label>
                                <select class="form-select" id="department" multiple>
                                    <option value="warehouse">Almacén</option>
                                    <option value="maintenance">Mantenimiento</option>
                                    <option value="production">Producción</option>
                                    <option value="logistics">Logística</option>
                                    <option value="purchasing">Compras</option>
                                </select>
                                <small class="text-muted">Mantén CTRL para seleccionar múltiples</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="scenarioDescription" class="form-label">Descripción Detallada *</label>
                            <textarea class="form-control" id="scenarioDescription" rows="4" 
                                      placeholder="Describe el contexto, objetivos y desafíos del escenario..." required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="difficulty" class="form-label">Nivel de Dificultad *</label>
                                <select class="form-select" id="difficulty" required>
                                    <option value="easy">Fácil</option>
                                    <option value="medium" selected>Media</option>
                                    <option value="hard">Difícil</option>
                                    <option value="expert">Experto</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="timeLimit" class="form-label">Tiempo Límite (min) *</label>
                                <input type="number" class="form-control" id="timeLimit" 
                                       value="45" min="10" max="180" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="maxPoints" class="form-label">Puntos Máximos *</label>
                                <input type="number" class="form-control" id="maxPoints" 
                                       value="100" min="50" max="500" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="attempts" class="form-label">Intentos Permitidos</label>
                                <input type="number" class="form-control" id="attempts" 
                                       value="3" min="1" max="10">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Recursos Requeridos</label>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resource1">
                                        <label class="form-check-label" for="resource1">Herramientas</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resource2">
                                        <label class="form-check-label" for="resource2">Equipo Seguridad</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resource3">
                                        <label class="form-check-label" for="resource3">Repuestos</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resource4">
                                        <label class="form-check-label" for="resource4">Documentación</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="learningObjectives" class="form-label">Objetivos de Aprendizaje</label>
                            <textarea class="form-control" id="learningObjectives" rows="3" 
                                      placeholder="Qué habilidades se desarrollarán con este escenario..."></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="evaluationCriteria" class="form-label">Criterios de Evaluación</label>
                            <div id="criteriaList">
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" placeholder="Ej: Tiempo de respuesta">
                                    <span class="input-group-text">Peso: </span>
                                    <input type="number" class="form-control" placeholder="%" style="max-width: 80px;">
                                    <button class="btn btn-outline-danger" type="button">×</button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" id="addCriterion">
                                <i class="bi bi-plus"></i> Añadir Criterio
                            </button>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
                                <i class="bi bi-arrow-left me-2"></i>Cancelar
                            </button>
                            <div>
                                <button type="button" class="btn btn-info me-2">
                                    <i class="bi bi-eye me-2"></i>Vista Previa
                                </button>
                                <button type="submit" class="btn btn-warning">
                                    <i class="bi bi-save me-2"></i>Guardar Escenario
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i> Instrucciones para Crear Escenarios</h5>
                </div>
                <div class="card-body">
                    <ul>
                        <li><strong>Nombre:</strong> Debe ser descriptivo y reflejar el objetivo del escenario.</li>
                        <li><strong>Dificultad:</strong> Considera el nivel de experiencia de los participantes.</li>
                        <li><strong>Tiempo límite:</strong> Ajusta según la complejidad (10-180 minutos recomendado).</li>
                        <li><strong>Recursos:</strong> Especifica los recursos necesarios para completar el escenario.</li>
                        <li><strong>Objetivos:</strong> Define claramente qué se espera que aprenda el participante.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Generar código automático
    document.getElementById('scenarioName').addEventListener('input', function() {
        const name = this.value;
        if (name.length > 0) {
            const initials = name.match(/\b(\w)/g).join('').toUpperCase();
            const code = 'MRO-' + initials.substring(0, 3) + '-' + 
                        Math.floor(100 + Math.random() * 900);
            document.getElementById('scenarioCode').value = code;
        }
    });
    
    // Añadir criterios de evaluación
    document.getElementById('addCriterion').addEventListener('click', function() {
        const criteriaList = document.getElementById('criteriaList');
        const newCriterion = document.createElement('div');
        newCriterion.className = 'input-group mb-2';
        newCriterion.innerHTML = `
            <input type="text" class="form-control" placeholder="Criterio de evaluación">
            <span class="input-group-text">Peso: </span>
            <input type="number" class="form-control" placeholder="%" style="max-width: 80px;" min="1" max="100">
            <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">×</button>
        `;
        criteriaList.appendChild(newCriterion);
    });
    
    // Validar formulario
    document.getElementById('scenarioForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (validateForm()) {
            alert('Escenario creado exitosamente. Será revisado por el administrador.');
            // Aquí iría la lógica para guardar en base de datos
        }
    });
    
    function validateForm() {
        const name = document.getElementById('scenarioName').value;
        const type = document.getElementById('scenarioType').value;
        const desc = document.getElementById('scenarioDescription').value;
        
        if (!name || !type || !desc) {
            alert('Por favor complete los campos obligatorios (*)');
            return false;
        }
        
        return true;
    }
</script>

<style>
    .form-control:focus, .form-select:focus {
        border-color: #ffc107;
        box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25);
    }
</style>
{% endblock %}
